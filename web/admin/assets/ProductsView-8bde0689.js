import{_ as z,q,u as K,g as r,h as E,o as m,c as y,a as t,k as V,i as x,w as k,l as H,b,m as n,v as j,p as v,s as U}from"./index-e339bdcb.js";import{_ as G,a as J,g as L,c as O,u as M}from"./Pagination-0226a04b.js";import{_ as Q}from"./DataTable-3636bea7.js";import{M as W}from"./ModalDialog-cb5c6411.js";const X={class:"products-page"},Y={class:"filter-row"},Z={class:"filter-item"},ee={class:"filter-item"},te={class:"filter-item"},ae={class:"filter-row"},le={class:"filter-item"},se={class:"data-card"},oe={key:0,class:"modal-form"},ie={class:"form-group"},ue={class:"form-group"},re={class:"form-group"},ne={key:0,class:"form-group"},de={class:"radio-group"},ce={class:"radio-label"},ve={class:"radio-label"},pe={__name:"ProductsView",setup(me){const{showNotification:c}=q(),h=K(),w=r([]),C=r({}),o=r({status:"all",minPrice:"",maxPrice:"",search:""}),i=r({page:1,pageSize:10,totalItems:0,totalPages:0}),p=r(!1),u=r(""),f=r(""),l=r({id:null,name:"",price:"",description:"",status:"active"}),g=r(!1),S=[{text:"ID",value:"id"},{text:"商品名称",value:"name"},{text:"价格",value:"price",formatter:a=>`${a} USDT`},{text:"已售",value:"soldCount",formatter:a=>a||0},{text:"可用卡密",value:"availableCount",formatter:a=>a||0},{text:"状态",value:"status",type:"status",formatter:a=>({status:a,text:a==="active"?"上架中":"已下架"})},{text:"操作",value:"actions",type:"actions",actions:[{action:"edit",icon:"ri-edit-line"},{action:"toggle",icon:a=>a.status==="active"?"ri-eye-off-line":"ri-eye-line"},{action:"addKeys",icon:"ri-key-line"}]}],d=async()=>{g.value=!0;try{const a={page:i.value.page,pageSize:i.value.pageSize};o.value.status&&o.value.status!=="all"&&(a.status=o.value.status),o.value.minPrice&&(a.minPrice=o.value.minPrice),o.value.maxPrice&&(a.maxPrice=o.value.maxPrice),o.value.search&&(a.search=o.value.search);const e=await L(a);w.value=e.data,e.pagination&&(i.value={...i.value,...e.pagination})}catch(a){console.error("获取商品列表失败:",a)}finally{g.value=!1}},$=()=>{i.value.page=1,d()},T=()=>{i.value.page=1,d()},F=()=>{o.value={status:"all",minPrice:"",maxPrice:"",search:""},i.value.page=1,d()},N=a=>{i.value.page=a,d()},D=({action:a,item:e})=>{C.value=e,a==="edit"?(u.value="editProduct",f.value="编辑商品",l.value={...e},p.value=!0):a==="toggle"?B(e):a==="addKeys"&&h.push({path:"/cardkeys",query:{productId:e.id}})},I=()=>{l.value={id:null,name:"",price:"",description:"",status:"active"},u.value="addProduct",f.value="添加商品",p.value=!0},P=()=>{p.value=!1},R=async()=>{u.value==="addProduct"||u.value==="editProduct"?await A():P()},A=async()=>{if(!l.value.name||!l.value.price){c("error","提交失败","请填写完整的商品信息");return}try{u.value==="addProduct"?(await O({name:l.value.name,price:parseFloat(l.value.price),description:l.value.description}),c("success","添加成功","商品已成功添加")):(await M(l.value.id,{name:l.value.name,price:parseFloat(l.value.price),description:l.value.description,status:l.value.status}),c("success","更新成功","商品信息已成功更新")),P(),d()}catch(a){console.error("提交商品失败:",a),c("error","提交失败",a.message||"提交商品信息时发生错误")}},B=async a=>{const e=a.status==="active"?"deleted":"active",s=e==="active"?"上架":"下架";try{await M(a.id,{status:e}),c("success",`${s}成功`,`商品已成功${s}`),d()}catch(_){console.error("更新商品状态失败:",_),c("error",`${s}失败`,_.message||`${s}商品时发生错误`)}};return E(()=>{d()}),(a,e)=>(m(),y("div",X,[t("div",{class:"page-header"},[e[11]||(e[11]=t("h2",null,"商品管理",-1)),t("div",{class:"header-actions"},[t("button",{class:"btn-primary",onClick:I},e[9]||(e[9]=[t("i",{class:"ri-add-line"},null,-1),V(" 添加商品 ")])),t("button",{class:"btn-secondary",onClick:$},e[10]||(e[10]=[t("i",{class:"ri-refresh-line"},null,-1),V(" 刷新 ")]))])]),x(G,{onReset:F,onApply:T},{default:k(()=>[t("div",Y,[t("div",Z,[e[13]||(e[13]=t("label",null,"商品状态",-1)),n(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>o.value.status=s),class:"select-input"},e[12]||(e[12]=[t("option",{value:"all"},"全部商品",-1),t("option",{value:"active"},"上架中",-1),t("option",{value:"deleted"},"已下架",-1)]),512),[[j,o.value.status,void 0,{trim:!0}]])]),t("div",ee,[e[14]||(e[14]=t("label",null,"最低价格",-1)),n(t("input",{type:"number","onUpdate:modelValue":e[1]||(e[1]=s=>o.value.minPrice=s),class:"form-input",placeholder:"最低价格"},null,512),[[v,o.value.minPrice,void 0,{trim:!0}]])]),t("div",te,[e[15]||(e[15]=t("label",null,"最高价格",-1)),n(t("input",{type:"number","onUpdate:modelValue":e[2]||(e[2]=s=>o.value.maxPrice=s),class:"form-input",placeholder:"最高价格"},null,512),[[v,o.value.maxPrice,void 0,{trim:!0}]])])]),t("div",ae,[t("div",le,[e[16]||(e[16]=t("label",null,"搜索",-1)),n(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=s=>o.value.search=s),class:"form-input",placeholder:"商品名称/描述"},null,512),[[v,o.value.search,void 0,{trim:!0}]])])])]),_:1}),t("div",se,[x(Q,{headers:S,data:w.value,loading:g.value,"empty-text":"没有找到商品","empty-icon":"ri-shopping-bag-line",onRowAction:D},null,8,["data","loading"]),i.value.totalPages>1?(m(),H(J,{key:0,page:i.value.page,"total-pages":i.value.totalPages,"total-items":i.value.totalItems,onPageChange:N},null,8,["page","total-pages","total-items"])):b("",!0)]),x(W,{show:p.value,title:f.value,"modal-type":u.value,onClose:P,onSubmit:R},{default:k(()=>[u.value==="addProduct"||u.value==="editProduct"?(m(),y("div",oe,[t("div",ie,[e[17]||(e[17]=t("label",null,"商品名称",-1)),n(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=s=>l.value.name=s),class:"form-input",placeholder:"请输入商品名称"},null,512),[[v,l.value.name,void 0,{trim:!0}]])]),t("div",ue,[e[18]||(e[18]=t("label",null,"价格 (USDT)",-1)),n(t("input",{type:"number","onUpdate:modelValue":e[5]||(e[5]=s=>l.value.price=s),class:"form-input",placeholder:"请输入价格"},null,512),[[v,l.value.price,void 0,{trim:!0}]])]),t("div",re,[e[19]||(e[19]=t("label",null,"描述",-1)),n(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=s=>l.value.description=s),class:"form-textarea",placeholder:"请输入商品描述"},null,512),[[v,l.value.description,void 0,{trim:!0}]])]),u.value==="editProduct"?(m(),y("div",ne,[e[22]||(e[22]=t("label",null,"状态",-1)),t("div",de,[t("label",ce,[n(t("input",{type:"radio","onUpdate:modelValue":e[7]||(e[7]=s=>l.value.status=s),value:"active"},null,512),[[U,l.value.status,void 0,{trim:!0}]]),e[20]||(e[20]=t("span",null,"上架",-1))]),t("label",ve,[n(t("input",{type:"radio","onUpdate:modelValue":e[8]||(e[8]=s=>l.value.status=s),value:"deleted"},null,512),[[U,l.value.status,void 0,{trim:!0}]]),e[21]||(e[21]=t("span",null,"下架",-1))])])])):b("",!0)])):b("",!0)]),_:1},8,["show","title","modal-type"])]))}},xe=z(pe,[["__scopeId","data-v-d7ce3779"]]);export{xe as default};
