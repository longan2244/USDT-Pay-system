import{r as U,_ as R,g as u,h as j,o as n,c as r,a as e,k as L,i as h,w as N,l as E,b as v,m,v as H,F as S,j as O,p as x,t as d}from"./index-e339bdcb.js";import{_ as G,a as J,g as Q}from"./Pagination-0226a04b.js";import{_ as W,a as X}from"./DataTable-3636bea7.js";import{M as Y}from"./ModalDialog-cb5c6411.js";function Z(g){return U({url:"/admin/orders",method:"get",params:g})}function tt(g){return U({url:"/admin/confirm-payment",method:"post",data:g})}const et={class:"orders-page"},at={class:"filter-row"},st={class:"filter-item"},lt={class:"filter-item"},ot=["value"],it={class:"filter-item"},nt={class:"filter-row"},rt={class:"filter-item"},ut={class:"filter-item"},dt={class:"data-card"},vt={key:0,class:"order-details"},pt={class:"detail-group"},ct={class:"detail-value"},mt={class:"detail-group"},ft={class:"detail-value"},gt={class:"detail-group"},yt={class:"detail-value"},_t={class:"detail-group"},ht={class:"detail-value"},xt={class:"detail-group"},bt={class:"detail-value"},Dt={key:0,class:"detail-group"},wt={class:"detail-value"},kt={key:1,class:"detail-group"},It={class:"detail-value"},Pt={key:2,class:"detail-group"},Vt={class:"detail-value"},Nt={key:3},Ht={class:"card-keys-list"},St={class:"card-key-value"},Ot={key:1,class:"modal-form"},Ut={class:"form-group"},Ct=["value"],Mt={class:"form-group"},Tt=["value"],$t={class:"form-group"},Ft={__name:"OrdersView",setup(g){const k=u([]),I=u([]),o=u({}),s=u({status:"all",productId:"",startDate:"",endDate:"",search:""}),i=u({page:1,pageSize:10,totalItems:0,totalPages:0}),y=u(!1),p=u(""),b=u(""),f=u({txHash:""}),D=u(!1),P=a=>a?new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",C=[{text:"订单ID",value:"id",formatter:a=>a.substring(0,8)+"..."},{text:"商品",value:"items",formatter:(a,t)=>V(t)},{text:"金额",value:"amount",formatter:a=>`${a} USDT`},{text:"状态",value:"status",type:"status"},{text:"创建时间",value:"createdAt",formatter:P},{text:"操作",value:"actions",type:"actions",actions:[{action:"view",icon:"ri-eye-line"},{action:"confirm",icon:"ri-check-line",condition:a=>a.status==="pending"}]}],c=async()=>{D.value=!0;try{const a={page:i.value.page,pageSize:i.value.pageSize};s.value.status&&s.value.status!=="all"&&(a.status=s.value.status),s.value.productId&&(a.productId=s.value.productId),s.value.startDate&&(a.startDate=s.value.startDate),s.value.endDate&&(a.endDate=s.value.endDate),s.value.search&&(a.search=s.value.search);const t=await Z(a);k.value=t.data,t.pagination&&(i.value={...i.value,...t.pagination})}catch(a){console.error("获取订单列表失败:",a)}finally{D.value=!1}},M=async()=>{try{const t=await Q({pageSize:100,status:"active"});I.value=t.data}catch(a){console.error("获取商品列表失败:",a)}},T=()=>{i.value.page=1,c()},$=()=>{i.value.page=1,c()},F=()=>{s.value={status:"all",productId:"",startDate:"",endDate:"",search:""},i.value.page=1,c()},z=a=>{i.value.page=a,c()},A=({action:a,item:t})=>{o.value=t,a==="view"?(p.value="orderDetails",b.value="订单详情",y.value=!0):a==="confirm"&&(p.value="confirmPayment",b.value="确认支付",f.value.txHash="",y.value=!0)},w=()=>{y.value=!1},K=async()=>{p.value==="confirmPayment"?await B():w()},B=async()=>{if(f.value.txHash)try{const a=await tt({orderId:o.value.id,txHash:f.value.txHash});w(),c()}catch(a){console.error("确认支付失败:",a)}},V=a=>a.productName?a.productName:a.items&&a.items.length>0?a.items.map(l=>l.quantity>1?`${l.productName} x${l.quantity}`:l.productName).join(", "):"未知商品";return j(()=>{c(),M()}),(a,t)=>(n(),r("div",et,[e("div",{class:"page-header"},[t[7]||(t[7]=e("h2",null,"订单管理",-1)),e("div",{class:"header-actions"},[e("button",{class:"btn-primary",onClick:T},t[6]||(t[6]=[e("i",{class:"ri-refresh-line"},null,-1),L(" 刷新 ")]))])]),h(G,{onReset:F,onApply:$},{default:N(()=>[e("div",at,[e("div",st,[t[9]||(t[9]=e("label",null,"订单状态",-1)),m(e("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>s.value.status=l),class:"select-input"},t[8]||(t[8]=[e("option",{value:"all"},"全部订单",-1),e("option",{value:"pending"},"待支付",-1),e("option",{value:"processing"},"处理中",-1),e("option",{value:"completed"},"已完成",-1)]),512),[[H,s.value.status,void 0,{trim:!0}]])]),e("div",lt,[t[11]||(t[11]=e("label",null,"商品",-1)),m(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>s.value.productId=l),class:"select-input"},[t[10]||(t[10]=e("option",{value:""},"全部商品",-1)),(n(!0),r(S,null,O(I.value,l=>(n(),r("option",{key:l.id,value:l.id},d(l.name),9,ot))),128))],512),[[H,s.value.productId,void 0,{trim:!0}]])]),e("div",it,[t[12]||(t[12]=e("label",null,"搜索",-1)),m(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=l=>s.value.search=l),class:"form-input",placeholder:"订单ID/商品名称/联系方式/付款地址"},null,512),[[x,s.value.search,void 0,{trim:!0}]])])]),e("div",nt,[e("div",rt,[t[13]||(t[13]=e("label",null,"开始日期",-1)),m(e("input",{type:"date","onUpdate:modelValue":t[3]||(t[3]=l=>s.value.startDate=l),class:"form-input"},null,512),[[x,s.value.startDate,void 0,{trim:!0}]])]),e("div",ut,[t[14]||(t[14]=e("label",null,"结束日期",-1)),m(e("input",{type:"date","onUpdate:modelValue":t[4]||(t[4]=l=>s.value.endDate=l),class:"form-input"},null,512),[[x,s.value.endDate,void 0,{trim:!0}]])])])]),_:1}),e("div",dt,[h(W,{headers:C,data:k.value,loading:D.value,"empty-text":"没有找到订单","empty-icon":"ri-file-list-3-line",onRowAction:A},null,8,["data","loading"]),i.value.totalPages>1?(n(),E(J,{key:0,page:i.value.page,"total-pages":i.value.totalPages,"total-items":i.value.totalItems,onPageChange:z},null,8,["page","total-pages","total-items"])):v("",!0)]),h(Y,{show:y.value,title:b.value,"modal-type":p.value,onClose:w,onSubmit:K},{default:N(()=>{var l;return[p.value==="orderDetails"?(n(),r("div",vt,[e("div",pt,[t[15]||(t[15]=e("span",{class:"detail-label"},"订单ID:",-1)),e("span",ct,d(o.value.id),1)]),e("div",mt,[t[16]||(t[16]=e("span",{class:"detail-label"},"商品:",-1)),e("span",ft,d(V(o.value)),1)]),e("div",gt,[t[17]||(t[17]=e("span",{class:"detail-label"},"金额:",-1)),e("span",yt,d(o.value.amount)+" USDT",1)]),e("div",_t,[t[18]||(t[18]=e("span",{class:"detail-label"},"状态:",-1)),e("span",ht,[h(X,{status:o.value.status},null,8,["status"])])]),e("div",xt,[t[19]||(t[19]=e("span",{class:"detail-label"},"创建时间:",-1)),e("span",bt,d(P(o.value.createdAt)),1)]),o.value.txHash?(n(),r("div",Dt,[t[20]||(t[20]=e("span",{class:"detail-label",style:{"white-space":"nowrap"}},"交易哈希:",-1)),e("span",wt,d(o.value.txHash),1)])):v("",!0),o.value.txHash?(n(),r("div",kt,[t[21]||(t[21]=e("span",{class:"detail-label"},"付款地址:",-1)),e("span",It,d((l=o.value.paymentInfo)==null?void 0:l.from),1)])):v("",!0),o.value.cardKey?(n(),r("div",Pt,[t[22]||(t[22]=e("span",{class:"detail-label"},"卡密:",-1)),e("span",Vt,d(o.value.cardKey),1)])):v("",!0),o.value.cardKeys&&o.value.cardKeys.length>0?(n(),r("div",Nt,[t[23]||(t[23]=e("h3",null,"卡密列表",-1)),e("div",Ht,[(n(!0),r(S,null,O(o.value.cardKeys,(_,q)=>(n(),r("div",{key:q,class:"card-key-item"},[e("span",null,d(_.productName)+": ",1),e("span",St,d(_.key),1)]))),128))])])):v("",!0)])):v("",!0),p.value==="confirmPayment"?(n(),r("div",Ot,[e("div",Ut,[t[24]||(t[24]=e("label",null,"订单ID",-1)),e("input",{type:"text",value:o.value.id,class:"form-input",disabled:""},null,8,Ct)]),e("div",Mt,[t[25]||(t[25]=e("label",null,"金额",-1)),e("input",{type:"text",value:o.value.amount+" USDT",class:"form-input",disabled:""},null,8,Tt)]),e("div",$t,[t[26]||(t[26]=e("label",null,"交易哈希",-1)),m(e("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=_=>f.value.txHash=_),class:"form-input",placeholder:"请输入交易哈希"},null,512),[[x,f.value.txHash,void 0,{trim:!0}]])])])):v("",!0)]}),_:1},8,["show","title","modal-type"])]))}},qt=R(Ft,[["__scopeId","data-v-c1fcdbad"]]);export{qt as default};
