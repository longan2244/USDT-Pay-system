import{_ as M,u as I,g as u,e as V,h as N,o as i,c as o,i as T,L as U,a as s,m as v,p as m,z as J,n as H,k as S,w as q,A as E,B as g,C as W,t as r,b as d,D as B}from"./index-e339bdcb.js";import{M as L}from"./ModalDialog-cb5c6411.js";const R={class:"settings-page"},j={class:"settings-card"},z={class:"settings-section"},G={class:"form-group"},$={class:"settings-section"},F={class:"form-group"},Q={class:"input-with-button"},X=["type"],Y={class:"settings-section"},Z={class:"form-group"},ee={class:"form-group"},se={class:"form-group"},le={class:"form-group"},te={class:"settings-section"},ae={class:"form-group"},ie={class:"settings-section"},oe={class:"form-group"},ne={key:0,class:"modal-form"},de={class:"settings-summary"},re={key:0,class:"detail-group"},ue={class:"detail-value"},ve={key:1,class:"detail-group"},pe={key:2,class:"detail-group"},me={key:3,class:"detail-group"},ge={class:"detail-value"},ce={key:4,class:"detail-group"},ye={class:"detail-value"},fe={key:5,class:"detail-group"},we={key:6,class:"detail-group"},be={class:"detail-value"},Se={key:7,class:"detail-group"},ke={key:8,class:"detail-group"},_e={class:"detail-value"},xe={key:9,class:"detail-group"},Te={class:"detail-value"},Ce={key:10,class:"detail-group"},he={class:"detail-value"},Ae={key:11,class:"detail-group"},De={class:"detail-value"},Ke={key:12,class:"detail-group"},Oe={class:"detail-value"},Pe={key:13,class:"detail-group"},Me={class:"detail-value"},Ie={key:14,class:"detail-group"},Ve={class:"detail-value"},Ne={key:15,class:"detail-group"},Ue={class:"detail-value"},Je={key:16,class:"detail-group"},He={class:"detail-value"},qe={key:17,class:"detail-group"},Ee={class:"detail-value"},We={key:18,class:"no-changes-message"},Be={__name:"SettingsView",setup(Le){const C=I(),l=u({port:9998,jwtSecret:"",adminKey:"",walletAddress:"",fullHost:"",privateKey:"",contractAddress:"",apiKey:"",pollingTime:15,expirationTime:20,requiredConfirmations:19,checkTimeWindow:60,randomDecimalMin:.01,randomDecimalMax:.5,maxPendingOrdersPerDevice:2,orderCreationCooldown:5,maxOrdersInCooldownPeriod:2,dataSaveInterval:5}),t=u({}),c=u(!1);u(!1);const f=u(!1),y=u(""),k=u(""),p=u(!1),w=u([]),h=V(()=>!l.value.walletAddress||!l.value.apiKey),A=async()=>{p.value=!0;try{const n=await E();l.value=n.data,t.value=JSON.parse(JSON.stringify(n.data)),h.value&&_([".usdtinput",".apikeyinput"])}catch(n){console.error("获取系统设置失败:",n)}finally{p.value=!1}},D=()=>{if(!l.value.walletAddress||!l.value.apiKey){g("error","配置错误","USDT地址和API密钥不能为空"),_([".usdtinput",".apikeyinput"]);return}y.value="confirmSettings",k.value="确认修改系统设置",f.value=!0},K=async()=>{try{p.value=!0;const n=await B(l.value);l.value=n.data,t.value=JSON.parse(JSON.stringify(n.data)),b(),l.value.walletAddress&&l.value.apiKey?(g("success","系统设置已保存","所有配置已完成，系统可以正常使用"),setTimeout(()=>{C.go(0)},1e3)):g("warning","系统设置已保存","但关键配置仍未完成，部分功能将不可用")}catch(n){console.error("保存系统设置失败:",n),g("error","保存失败","系统设置保存失败，请稍后重试")}finally{p.value=!1}},O=async()=>{try{p.value=!0;const n=await W();l.value=n.data,t.value=JSON.parse(JSON.stringify(n.data)),g("info","设置已撤回","已恢复到上一次保存的设置")}catch(n){console.error("恢复上一次设置失败:",n),g("error","撤回失败","无法恢复上一次的设置")}finally{p.value=!1}},b=()=>{f.value=!1},P=async()=>{y.value==="confirmSettings"?await K():b()},_=n=>{x(),n.forEach(e=>{const a=document.querySelector(e);a&&(a.classList.add("highlight-section"),w.value.push(a),n.indexOf(e)===0&&a.scrollIntoView({behavior:"smooth"}))}),setTimeout(()=>{x()},3e3)},x=()=>{w.value.forEach(n=>{n.classList.remove("highlight-section")}),w.value=[]};return N(()=>{A()}),(n,e)=>(i(),o("div",R,[T(U,{"is-loading":p.value},null,8,["is-loading"]),e[46]||(e[46]=s("div",{class:"page-header"},[s("h2",null,"系统设置")],-1)),s("div",j,[s("div",z,[e[11]||(e[11]=s("h3",null,"服务器配置",-1)),s("div",G,[e[9]||(e[9]=s("label",null,"服务器端口",-1)),v(s("input",{type:"number","onUpdate:modelValue":e[0]||(e[0]=a=>l.value.port=a),class:"form-input",placeholder:"服务器端口"},null,512),[[m,l.value.port,void 0,{trim:!0}]]),e[10]||(e[10]=s("small",{class:"form-hint"},"修改后需要重启服务器生效",-1))])]),s("div",$,[e[13]||(e[13]=s("h3",null,"管理员配置",-1)),s("div",F,[e[12]||(e[12]=s("label",null,"管理员密码",-1)),s("div",Q,[v(s("input",{type:c.value?"text":"password","onUpdate:modelValue":e[1]||(e[1]=a=>l.value.adminKey=a),class:"form-input",placeholder:"管理员密码"},null,8,X),[[J,l.value.adminKey,void 0,{trim:!0}]]),s("button",{class:"btn-icon",onClick:e[2]||(e[2]=a=>c.value=!c.value)},[s("i",{class:H(c.value?"ri-eye-off-line":"ri-eye-line")},null,2)])])])]),s("div",Y,[e[18]||(e[18]=s("h3",null,"Tron配置",-1)),s("div",Z,[e[14]||(e[14]=s("label",null,"收款钱包地址 TRC20",-1)),v(s("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=a=>l.value.walletAddress=a),class:"form-input usdtinput",placeholder:"USDT钱包地址"},null,512),[[m,l.value.walletAddress,void 0,{trim:!0}]])]),s("div",ee,[e[15]||(e[15]=s("label",null,[S("API Key "),s("small",{class:"form-hint"},[s("a",{href:"https://www.trongrid.io/",target:"_blank"},"前往申请")])],-1)),v(s("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=a=>l.value.apiKey=a),class:"form-input apikeyinput",placeholder:"TRON Grid API Key"},null,512),[[m,l.value.apiKey,void 0,{trim:!0}]])]),s("div",se,[e[16]||(e[16]=s("label",null,[S("节点地址"),s("small",{class:"form-hint"},"不懂不要乱改")],-1)),v(s("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=a=>l.value.fullHost=a),class:"form-input",placeholder:"TRON节点地址"},null,512),[[m,l.value.fullHost,void 0,{trim:!0}]])]),s("div",le,[e[17]||(e[17]=s("label",null,[S("合约地址"),s("small",{class:"form-hint"},"不懂不要乱改")],-1)),v(s("input",{type:"text","onUpdate:modelValue":e[6]||(e[6]=a=>l.value.contractAddress=a),class:"form-input",placeholder:"USDT合约地址"},null,512),[[m,l.value.contractAddress,void 0,{trim:!0}]])])]),s("div",te,[e[21]||(e[21]=s("h3",null,"订单配置",-1)),s("div",ae,[e[19]||(e[19]=s("label",null,"订单过期时间(分钟)",-1)),v(s("input",{type:"number","onUpdate:modelValue":e[7]||(e[7]=a=>l.value.expirationTime=a),class:"form-input",placeholder:"订单过期时间"},null,512),[[m,l.value.expirationTime,void 0,{trim:!0}]]),e[20]||(e[20]=s("small",{class:"form-hint"},"订单创建后的有效时间",-1))])]),s("div",ie,[e[24]||(e[24]=s("h3",null,"数据保存配置",-1)),s("div",oe,[e[22]||(e[22]=s("label",null,"数据保存间隔(分钟)",-1)),v(s("input",{type:"number","onUpdate:modelValue":e[8]||(e[8]=a=>l.value.dataSaveInterval=a),class:"form-input",placeholder:"数据保存间隔"},null,512),[[m,l.value.dataSaveInterval,void 0,{trim:!0}]]),e[23]||(e[23]=s("small",{class:"form-hint"},"系统自动保存数据的时间间隔",-1))])]),s("div",{class:"form-actions"},[s("button",{class:"btn-primary",onClick:D},"保存设置"),s("button",{class:"btn-secondary",onClick:O},"撤回")])]),T(L,{show:f.value,title:k.value,"modal-type":y.value,onClose:b,onSubmit:P},{default:q(()=>[y.value==="confirmSettings"?(i(),o("div",ne,[e[45]||(e[45]=s("div",{class:"warning-message"},[s("i",{class:"ri-alert-line"}),s("p",null,"您正在修改系统关键设置，这可能会影响系统的正常运行。请确认您了解所做的更改并确认继续。")],-1)),s("div",de,[e[44]||(e[44]=s("h3",null,"即将修改的设置:",-1)),l.value.port!==t.value.port?(i(),o("div",re,[e[25]||(e[25]=s("span",{class:"detail-label"},"服务器端口:",-1)),s("span",ue,r(l.value.port),1)])):d("",!0),l.value.jwtSecret!==t.value.jwtSecret?(i(),o("div",ve,e[26]||(e[26]=[s("span",{class:"detail-label"},"JWT密钥:",-1),s("span",{class:"detail-value"},"已修改",-1)]))):d("",!0),l.value.adminKey!==t.value.adminKey?(i(),o("div",pe,e[27]||(e[27]=[s("span",{class:"detail-label"},"管理员密码:",-1),s("span",{class:"detail-value"},"已修改",-1)]))):d("",!0),l.value.walletAddress!==t.value.walletAddress?(i(),o("div",me,[e[28]||(e[28]=s("span",{class:"detail-label"},"钱包地址:",-1)),s("span",ge,r(l.value.walletAddress),1)])):d("",!0),l.value.fullHost!==t.value.fullHost?(i(),o("div",ce,[e[29]||(e[29]=s("span",{class:"detail-label"},"节点地址:",-1)),s("span",ye,r(l.value.fullHost),1)])):d("",!0),l.value.privateKey!==t.value.privateKey?(i(),o("div",fe,e[30]||(e[30]=[s("span",{class:"detail-label"},"私钥:",-1),s("span",{class:"detail-value"},"已修改",-1)]))):d("",!0),l.value.contractAddress!==t.value.contractAddress?(i(),o("div",we,[e[31]||(e[31]=s("span",{class:"detail-label"},"合约地址:",-1)),s("span",be,r(l.value.contractAddress),1)])):d("",!0),l.value.apiKey!==t.value.apiKey?(i(),o("div",Se,e[32]||(e[32]=[s("span",{class:"detail-label"},"API Key:",-1),s("span",{class:"detail-value"},"已修改",-1)]))):d("",!0),l.value.pollingTime!==t.value.pollingTime?(i(),o("div",ke,[e[33]||(e[33]=s("span",{class:"detail-label"},"轮询时间:",-1)),s("span",_e,r(l.value.pollingTime)+" 秒",1)])):d("",!0),l.value.expirationTime!==t.value.expirationTime?(i(),o("div",xe,[e[34]||(e[34]=s("span",{class:"detail-label"},"过期时间:",-1)),s("span",Te,r(l.value.expirationTime)+" 分钟",1)])):d("",!0),l.value.requiredConfirmations!==t.value.requiredConfirmations?(i(),o("div",Ce,[e[35]||(e[35]=s("span",{class:"detail-label"},"交易确认数:",-1)),s("span",he,r(l.value.requiredConfirmations),1)])):d("",!0),l.value.checkTimeWindow!==t.value.checkTimeWindow?(i(),o("div",Ae,[e[36]||(e[36]=s("span",{class:"detail-label"},"交易检查时间窗口:",-1)),s("span",De,r(l.value.checkTimeWindow)+" 分钟",1)])):d("",!0),l.value.randomDecimalMin!==t.value.randomDecimalMin?(i(),o("div",Ke,[e[37]||(e[37]=s("span",{class:"detail-label"},"随机小数最小值:",-1)),s("span",Oe,r(l.value.randomDecimalMin),1)])):d("",!0),l.value.randomDecimalMax!==t.value.randomDecimalMax?(i(),o("div",Pe,[e[38]||(e[38]=s("span",{class:"detail-label"},"随机小数最大值:",-1)),s("span",Me,r(l.value.randomDecimalMax),1)])):d("",!0),l.value.maxPendingOrdersPerDevice!==t.value.maxPendingOrdersPerDevice?(i(),o("div",Ie,[e[39]||(e[39]=s("span",{class:"detail-label"},"每设备最大待处理订单数:",-1)),s("span",Ve,r(l.value.maxPendingOrdersPerDevice),1)])):d("",!0),l.value.orderCreationCooldown!==t.value.orderCreationCooldown?(i(),o("div",Ne,[e[40]||(e[40]=s("span",{class:"detail-label"},"订单创建冷却时间:",-1)),s("span",Ue,r(l.value.orderCreationCooldown)+" 分钟",1)])):d("",!0),l.value.maxOrdersInCooldownPeriod!==t.value.maxOrdersInCooldownPeriod?(i(),o("div",Je,[e[41]||(e[41]=s("span",{class:"detail-label"},"冷却期内最大订单数:",-1)),s("span",He,r(l.value.maxOrdersInCooldownPeriod),1)])):d("",!0),l.value.dataSaveInterval!==t.value.dataSaveInterval?(i(),o("div",qe,[e[42]||(e[42]=s("span",{class:"detail-label"},"数据保存间隔:",-1)),s("span",Ee,r(l.value.dataSaveInterval)+" 分钟",1)])):d("",!0),JSON.stringify(l.value)===JSON.stringify(t.value)?(i(),o("div",We,e[43]||(e[43]=[s("p",null,"没有检测到设置变更",-1)]))):d("",!0)])])):d("",!0)]),_:1},8,["show","title","modal-type"])]))}},ze=M(Be,[["__scopeId","data-v-68551123"]]);export{ze as default};
